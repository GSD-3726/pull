name: 定时同步触发Gitee流水线
on:
  schedule:
    - cron: '0 */2 * * *'  # UTC时间每两小时触发一次
  workflow_dispatch:

jobs:
  trigger-gitee-pipeline:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout GitHub Repo
        uses: actions/checkout@v4
      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
      - name: Clone and Sync to Gitee
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}
          GITEE_REPO: "https://gitee.com/bmg369/test.git"
          GITEE_BRANCH: "master"
        run: |
          # 克隆Gitee仓库
          git clone --depth 1 -b $GITEE_BRANCH https://oauth2:${GITEE_TOKEN}@${GITEE_REPO#https://} test
          
          # 这里可以添加你需要的具体同步操作，例如复制文件等
          # rsync -av ./ test/ --exclude='.git'
          
          # 提交并推送到Gitee，并在commit message中添加[skip ci]
          cd test
          git add .
          if ! git diff --staged --quiet; then
            git commit -m "Auto-sync from GitHub [skip ci]"
            git push origin $GITEE_BRANCH
            echo "代码已同步至Gitee，并标记了[skip ci]"
          else
            echo "无更改需要提交。"
          fi
