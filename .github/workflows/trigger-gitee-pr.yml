name: 定时触发Gitee流水线
on:
  schedule:
    - cron: '0 */2 * * *'  # 每2小时执行一次（UTC时间，需注意时区差）
  workflow_dispatch:  # 允许手动触发测试

jobs:
  trigger-gitee:
    runs-on: ubuntu-latest
    steps:
      - name: 配置Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: 克隆GitHub仓库
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 拉取完整历史

      - name: 推送触发Gitee
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}  # Gitee访问令牌（需提前配置）
          GITEE_REPO: "https://gitee.com/bmg369/test.git"
        run: |
          # 添加Gitee远程仓库（使用令牌认证）
          git remote add gitee https://oauth2:${GITEE_TOKEN}@$(echo $GITEE_REPO | cut -d'/' -f3-)
          
          # 创建带有特定标识的空提交（用于Gitee识别来源）
          git commit --allow-empty -m "[github-trigger] 定时触发Gitee流水线 $(date +%s)"
          
          # 推送至Gitee（可推送到特定分支，如main）
          git push gitee master --force-with-lease
