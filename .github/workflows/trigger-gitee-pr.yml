name: Trigger Gitee Pipeline via Branch Push

on:
  workflow_dispatch: # 允许手动触发

jobs:
  trigger-gitee-pipeline:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout GitHub code (Full History)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取完整历史记录，避免后续推送问题:cite[1]

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Add Gitee remote
        run: |
          git remote add gitee https://${{ secrets.GITEE_USERNAME }}:${{ secrets.GITEE_TOKEN }}@gitee.com/${{ secrets.GITEE_REPO }}.git

      - name: Create and push to trigger branch
        run: |
          # 定义一个专门用于触发的分支名称
          TRIGGER_BRANCH="trigger/pipeline-20251024"
          # 切换到该分支（基于当前检出的commit）
          git checkout -b $TRIGGER_BRANCH
          # 推送到Gitee仓库的指定分支
          git push gitee $TRIGGER_BRANCH
          echo "已推送代码至Gitee的 $TRIGGER_BRANCH 分支，流水线应被触发。"
