name: Trigger Gitee Pipeline

on:
  workflow_dispatch: # 允许手动触发
  schedule:
    # 此处可添加定时触发，例如 UTC 时间每天8点01分（北京时间16:01）运行
    # - cron: '01 8 * * *'

jobs:
  trigger-via-tag:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # 使用 Personal Access Token (PAT) 检出代码，这对于后续推送至关重要
          token: ${{ secrets.PAT_FOR_CI }}

      - name: Create a lightweight tag
        run: |
          # 生成一个基于时间戳的标签名，确保每次基本唯一
          TAG_NAME="trigger-pipeline-$(date +%s)"
          git tag $TAG_NAME
          echo "New tag created: $TAG_NAME"

      - name: Push tag to trigger Gitee
        run: |
          # 推送标签到Gitee远程仓库
          git push https://${{ secrets.GITEE_USERNAME }}:${{ secrets.GITEE_TOKEN }}@gitee.com/${{ secrets.GITEE_REPO_FULL_PATH }}.git --tags
